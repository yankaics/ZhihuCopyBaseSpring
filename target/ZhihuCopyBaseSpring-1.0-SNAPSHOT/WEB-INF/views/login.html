<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>知乎登陆</title>
    <link rel='stylesheet' href='/resources/stylesheets/bootstrap.min.css' />
    <link rel='stylesheet' href='/resources/stylesheets/login.css' />
    <script type="text/javascript" src="/resources/javascripts/jquery.js"></script>
    <script type="text/javascript" src="/resources/javascripts/bootstrap.js"></script>
</head>
<body ng-app="login" >
    <div class="page-body text-center" ng-controller="appCtrl">
        <div class="main-content" >
            <div class="index-header">
                <h1 class="logo">知乎</h1>
                <h4 class="subtitle" >与世界分享你的知识、经验和见解</h4>
            </div>
            <div class="index-tabnavs">
                <div class="nav-slider">
                    <a href="#signup" ng-class="{active:Actived ==='sign'}" ng-click="Actived = 'sign'">注册</a>
                    <a href="#signin" ng-class="{active:Actived ==='login'}" ng-click="Actived = 'login'">登陆</a>
                </div>
            </div>
            <div class="view-sign">
                <div ng-view="">
                    <input type="hidden" name="${_csrf.parameterName}" value="${_csrf.token}"/>
                </div>
            </div>
        </div>
    </div>

    <script type="text/javascript" src="/resources/javascripts/angular.min.js"></script>
    <script type="text/javascript" src="/resources/javascripts/angular-route.min.js"></script>
    <script>
        var app=angular.module("login",['ngRoute'])
                .config(['$routeProvider',
                    function ($routeProvider) {
                        $routeProvider.when('/', {
                            templateUrl: '/resources/partials/signPartials.html',
                            Actived: "sign"
                        }).when('/signup',{
                            templateUrl: '/resources/partials/signPartials.html',
                            Actived: "sign"
                        }).when('/signin',{
                            templateUrl: '/resources/partials/loginPartials.html',
                            Actived: "login"
                        });
                    }]);
                //定义Service
            app.factory('data', function () {

                var user ={
                    username : "",
                    password : ""
                };

                //供外界使用Singleton对象
                return {
                    user: user,  //返回内部包容数据对象给外界使用
                };
            });

            app.controller("appCtrl",function($scope){
                $scope.$on("$routeChangeSuccess", function(event, current, previous){
                    $scope.Actived = current.$$route.Actived;
                });
            });

            app.controller("signCtrl",function($scope,$http,data,$window){
                $scope.user ={
                    "username" : "",
                    "password" : ""
                };
                $scope.passwordAgain="";
                $scope.passwordNotAg = true;

                $scope.sign=function() {
                    data.user.username=$scope.user;
                    data.user.password=$scope.user.password;

                    var user =$scope.user;
                    console.log(user);

                    var response = $http({
                        url: "/login/signup",
                        method: "POST",
                        data: user,
                        headers: {
                            "Content-Type": "application/json"
                        }
                    });
                    response.success(function (data) {
                        console.log(data);
                        if(data==='success'){
                            $window.location.href='/index';
                        }
                        else
                            alert(data);

                    });
                    response.error(function (data) {
                        alert("error");
                        alert(data);
                        console.log(data);
                    });
                }
            });

            app.controller("loginCtrl",function($scope,$http,$window,$location){
                $scope.user ={
                    "username" : "",
                    "password" : ""
                };
                $scope.message = $location.search();
            });

            app.directive('ensureSame', function() {
                return {
                    restrict : 'A',
                    require: 'ngModel',
                    link: function(scope, ele, attrs) {
                        console.log(scope.passwordAgain);
                        scope.$watch(attrs.ngModel, function() {
                                if(scope.user.password!=scope.passwordAgain)
                                    scope.passwordNotAg=true;
                                else {
                                    scope.passwordNotAg=false;
                                }

                        });
                    }
                }
            });

    </script>
</body>

</html>
